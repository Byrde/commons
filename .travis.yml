sudo: required

# Defacto version and lang used in most Byrde projects.
language: scala
scala: 2.11.11

# Install Python 3, required for cloudsmith dependencies.
addons:
  apt:
    sources:
      - deadsnakes
    packages:
      - python3.6

# Install cloudsmit cli, required for publishing artifact.
install:
  - sudo pip install cloudsmith-cli

# Clean tracked binaries, run unit tests, and package artifact.
script:
  - sbt clean test package

# Cached dependencies cleanup.
before_cache:
  # Cleanup the cached directories to avoid unnecessary cache updates
  - find $HOME/.ivy2/cache -name "ivydata-*.properties" -print -delete
  - find $HOME/.sbt        -name "*.lock"               -print -delete

# Cache dependencies.
cache:
  directories:
    - $HOME/.ivy2/cache
    - $HOME/.sbt

# On script complete, publish artifact to cloudsmith.
after_success:
  - echo "Success - Branch($TRAVIS_BRANCH) Pull Request($TRAVIS_PULL_REQUEST) Tag($TRAVIS_TAG)"
  - export ARTIFACT=/
  - cloudsmith push maven byrde/libraries $ARTIFACT.jar
